<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escritorio Remoto</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>Escritorio Remoto</h1>
    <img id="remote-screen" alt="Remote Screen" />
    <html>
      <head>
        <title>Escritorio Remoto</title>
      </head>
      <body>
        <canvas id="screen" width="1280" height="720"></canvas>
        <script>
          const ws = new WebSocket("ws://192.168.1.127:8080/RemoteDesktop");
          const canvas = document.getElementById("screen");
          const ctx = canvas.getContext("2d");

          ws.onopen = function () {
            console.log("Conectado al servidor WebSocket");
            requestCapture();
          };

          ws.onmessage = function (event) {
            const blob = new Blob([event.data], { type: "image/jpeg" });
            const url = URL.createObjectURL(blob);
            const img = new Image();
            img.onload = function () {
              ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
              URL.revokeObjectURL(url); // Liberar memoria
              requestCapture(); // Solicitar la siguiente captura
            };
            img.src = url;
          };

          function requestCapture() {
            ws.send("capture");
          }

          // Capturar eventos del mouse y teclado para enviar al servidor
          canvas.addEventListener("mousemove", function (event) {
            const data = {
              type: "mousemove",
              x: event.offsetX,
              y: event.offsetY,
            };
            ws.send(JSON.stringify(data));
          });

          canvas.addEventListener("click", function (event) {
            const data = { type: "click", x: event.offsetX, y: event.offsetY };
            ws.send(JSON.stringify(data));
          });

          document.addEventListener("keydown", function (event) {
            const data = { type: "keydown", key: event.key };
            ws.send(JSON.stringify(data));
          });
        </script>
      </body>
    </html>
  </body>
</html>
